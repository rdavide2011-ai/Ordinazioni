<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RistoLux | Dave Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00b894;
            --chef: #2d3436;
            --prep: #0984e3;
            --accent: #fdcb6e;
            --danger: #ff7675;
            --bg: #f8f9fa;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: var(--bg); min-height: 100vh; display: flex; justify-content: center; color: #2d3436; }

        .hidden { display: none !important; }
        .container { width: 100%; max-width: 480px; padding: 20px; }

        /* Card Style */
        .card { 
            background: #ffffff; border-radius: 30px; padding: 30px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.05);
            transition: 0.3s; animation: slideIn 0.4s ease;
        }
        @keyframes slideIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        /* Buttons */
        .main-btn { 
            width: 100%; padding: 18px; border-radius: 20px; border: none; 
            font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: 0.3s;
            margin-bottom: 15px;
        }
        .main-btn:hover { transform: scale(1.02); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .btn-guest { background: var(--primary); color: white; }
        .btn-chef { background: var(--chef); color: white; }

        /* Inputs */
        input, textarea { 
            width: 100%; padding: 16px; border-radius: 15px; border: 2px solid #eee; 
            background: #fdfdfd; margin-bottom: 15px; outline: none; transition: 0.3s;
        }
        input:focus { border-color: var(--primary); }

        /* People Grid */
        .people-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-bottom: 15px; }
        .p-btn { 
            padding: 15px 5px; background: #eee; border-radius: 12px; 
            cursor: pointer; text-align: center; font-weight: bold;
        }
        .p-btn.active { background: var(--primary); color: white; transform: scale(1.05); }

        /* Status Ospite */
        .status-header { text-align: center; margin-bottom: 20px; }
        .status-icon { 
            width: 80px; height: 80px; border-radius: 50%; background: #f1f2f6;
            display: flex; align-items: center; justify-content: center; 
            font-size: 2rem; margin: 0 auto 15px; transition: 0.5s;
        }
        .bg-prep { background: var(--accent) !important; animation: pulse 2s infinite; }
        .bg-ready { background: var(--primary) !important; color: white; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* Chef Orders */
        .order-card { background: white; border-radius: 20px; padding: 20px; margin-bottom: 20px; border-left: 10px solid var(--chef); }
        .chef-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .c-btn { padding: 12px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; color: white; }
    </style>
</head>
<body>

<div class="container">
    
    <div id="view-login">
        <div style="text-align: center; margin: 60px 0;">
            <h1 style="font-size: 3rem; font-weight: 800; letter-spacing: -2px;">Risto<span style="color:var(--primary)">Lux</span></h1>
            <p style="color: #999;">Benvenuto nel sistema di ordinazione</p>
        </div>
        <button class="main-btn btn-guest" onclick="showGuestForm()">üçΩÔ∏è Entra come Ospite</button>
        <button class="main-btn btn-chef" onclick="showChefLogin()">üë®‚Äçüç≥ Dashboard Dave</button>
    </div>

    <div id="view-chef-auth" class="hidden">
        <div class="card">
            <h2 style="text-align:center">Area Riservata Chef</h2>
            <input type="password" id="chef-pass" placeholder="Password..." style="text-align:center; margin-top:20px">
            <button class="main-btn btn-chef" onclick="checkChefAuth()">ACCEDI</button>
            <button onclick="goHome()" style="width:100%; border:none; background:none; color:#999; cursor:pointer">Torna indietro</button>
        </div>
    </div>

    <div id="view-guest-form" class="hidden">
        <div class="card">
            <h2>Il tuo Tavolo</h2>
            <input type="number" id="inp-table" placeholder="Numero Tavolo">
            <div class="people-grid">
                <div class="p-btn" onclick="selPeople(1, this)">1</div>
                <div class="p-btn" onclick="selPeople(2, this)">2</div>
                <div class="p-btn" onclick="selPeople(3, this)">3</div>
                <div class="p-btn" onclick="selPeople(4, this)">4</div>
                <div class="p-btn" onclick="toggleCustomPeople(this)">+</div>
            </div>
            <input type="number" id="inp-people-custom" class="hidden" placeholder="Numero persone...">
            <input type="text" id="inp-names" placeholder="I vostri nomi">
            <textarea id="inp-food" rows="4" placeholder="Cosa desiderate ordinare?"></textarea>
            <button class="main-btn btn-guest" onclick="sendOrder()">INVIA ORDINE</button>
        </div>
    </div>

    <div id="view-guest-status" class="hidden">
        <div class="card" style="text-align: center;">
            <div id="status-icon" class="status-icon">‚úÖ</div>
            <h2 id="status-text">Consegnato con successo</h2>
            <p id="status-desc" style="color:#888; margin-bottom:20px">L'ordine √® in coda in cucina.</p>
            <div id="display-food" style="background:#f9f9f9; padding:15px; border-radius:15px; font-style:italic;"></div>
            <p style="margin-top:20px; font-size:0.8rem">Tavolo <strong id="display-tavolo"></strong></p>
            <button onclick="location.reload()" style="margin-top:30px; border:none; background:none; color:var(--danger); cursor:pointer">Annulla Ordine</button>
        </div>
    </div>

    <div id="view-chef-dash" class="hidden">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px">
            <h2>Ordini <span style="color:var(--primary)">Dave</span></h2>
            <button onclick="goHome()" style="padding:8px 15px; border-radius:10px; border:none;">Esci</button>
        </div>
        <div id="chef-orders-list"></div>
    </div>

</div>

<script>
    let orders = JSON.parse(localStorage.getItem('ristoOrders')) || [];
    let currentOrderId = null;
    let selectedPeopleCount = null;

    function goHome() { hideAll(); document.getElementById('view-login').classList.remove('hidden'); }
    function hideAll() { document.querySelectorAll('.container > div').forEach(d => d.classList.add('hidden')); }
    function showGuestForm() { hideAll(); document.getElementById('view-guest-form').classList.remove('hidden'); }
    function showChefLogin() { hideAll(); document.getElementById('view-chef-auth').classList.remove('hidden'); }

    function checkChefAuth() {
        if(document.getElementById('chef-pass').value === "DAVE2511") {
            hideAll(); document.getElementById('view-chef-dash').classList.remove('hidden');
            renderChefOrders();
            setInterval(renderChefOrders, 2000);
        } else { alert("Password Errata"); }
    }

    function selPeople(n, el) {
        selectedPeopleCount = n;
        document.querySelectorAll('.p-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        document.getElementById('inp-people-custom').classList.add('hidden');
    }

    function toggleCustomPeople(el) {
        document.querySelectorAll('.p-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        document.getElementById('inp-people-custom').classList.remove('hidden').focus();
    }

    function sendOrder() {
        const table = document.getElementById('inp-table').value;
        const food = document.getElementById('inp-food').value;
        if(!table || !food) return alert("Inserisci tavolo e piatti!");

        const order = {
            id: Date.now(),
            table,
            people: document.getElementById('inp-people-custom').value || selectedPeopleCount || 1,
            names: document.getElementById('inp-names').value || "Ospiti",
            food,
            status: 'inviato'
        };

        orders.push(order);
        save();
        currentOrderId = order.id;
        startTracking();
    }

    function startTracking() {
        hideAll();
        document.getElementById('view-guest-status').classList.remove('hidden');
        document.getElementById('display-tavolo').innerText = orders.find(o => o.id === currentOrderId).table;
        
        setInterval(() => {
            const live = JSON.parse(localStorage.getItem('ristoOrders')) || [];
            const my = live.find(o => o.id === currentOrderId);
            if(!my) return;

            const icon = document.getElementById('status-icon');
            const text = document.getElementById('status-text');
            const desc = document.getElementById('status-desc');
            document.getElementById('display-food').innerText = my.food;

            if(my.status === 'preparazione') {
                icon.innerHTML = "üë®‚Äçüç≥"; icon.className = "status-icon bg-prep";
                text.innerText = "In preparazione...";
                desc.innerText = "Dave sta cucinando i tuoi piatti!";
            } else if(my.status === 'pronto') {
                icon.innerHTML = "üçï"; icon.className = "status-icon bg-ready";
                text.innerText = "IL PIATTO √à PRONTO!";
                text.style.color = "var(--primary)";
                desc.innerText = "In arrivo al tuo tavolo.";
            }
        }, 2000);
    }

    function renderChefOrders() {
        orders = JSON.parse(localStorage.getItem('ristoOrders')) || [];
        const list = document.getElementById('chef-orders-list');
        list.innerHTML = orders.length === 0 ? '<p style="text-align:center; opacity:0.5;">Nessun ordine...</p>' : '';

        orders.forEach(o => {
            const div = document.createElement('div');
            div.className = 'order-card';
            div.innerHTML = `
                <div style="display:flex; justify-content:space-between">
                    <strong>Tavolo ${o.table}</strong>
                    <span>${o.people} Pers.</span>
                </div>
                <p style="font-size:0.8rem; color:#888">${o.names}</p>
                <textarea id="edit-${o.id}" style="margin:10px 0; font-size:0.9rem">${o.food}</textarea>
                <div class="chef-btns">
                    <button class="c-btn" style="background:var(--accent)" onclick="setStatus(${o.id}, 'preparazione')">IN PREPARAZIONE</button>
                    <button class="c-btn" style="background:var(--primary)" onclick="setStatus(${o.id}, 'pronto')">PRONTO</button>
                    <button class="c-btn" style="background:#ddd; color:#333" onclick="updateOrder(${o.id})">SALVA</button>
                    <button class="c-btn" style="background:var(--danger)" onclick="deleteOrder(${o.id})">ELIMINA</button>
                </div>
            `;
            list.appendChild(div);
        });
    }

    function setStatus(id, s) {
        orders = orders.map(o => o.id === id ? {...o, status: s} : o);
        save(); renderChefOrders();
    }

    function updateOrder(id) {
        const food = document.getElementById(`edit-${id}`).value;
        orders = orders.map(o => o.id === id ? {...o, food} : o);
        save(); alert("Modificato!");
    }

    function deleteOrder(id) {
        orders = orders.filter(o => o.id !== id);
        save(); renderChefOrders();
    }

    function save() { localStorage.setItem('ristoOrders', JSON.stringify(orders)); }
</script>

</body>
</html>
